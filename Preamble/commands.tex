%Font
%\newcommand{\ackfont}{\fontfamily{\Fontskrivan}\selectfont}
\newcommand{\ackfont}{\Fontskrivan}
%Colors
\definecolor{dkgreen}{RGB}{0, 153, 0}
\definecolor{dgreen}{rgb}{.2,.7,.2}

\makeatletter
\let\LaTeXStandardPart\part%
\newcommand{\unstarredpart@@noopt}[1]{%
    \unstarredpart@@opt[#1]{#1}%
}%
    
\newcommand{\unstarredpart@@opt}[2][]{%
  \cleardoublepage% (For clearing content before!!!)
  \begingroup%
  \let\newpage\relax%
  \LaTeXStandardPart[#1]{#2}%
  \endgroup%
}%
                
\newcommand{\starredpart}[1]{%
  \LaTeXStandardPart*{#1}%
}%

\newcommand{\unstarredpart}{%
  \@ifnextchar[{\unstarredpart@@opt}{\unstarredpart@@noopt}%
}%
\renewcommand{\part}{%
  \@ifstar{\starredpart}{\unstarredpart}%
}%of part

%cliquable links
\hypersetup{
colorlinks,
citecolor=black,
filecolor=black,
linkcolor=black,
urlcolor=black
}


%Todo notes: use \listoftodos[Notes] to display all the notes
\newif\ifreview
\reviewtrue
\ifreview
  \newcommandx{\unsure}[2][1=]{\todo[linecolor=red,backgroundcolor=red!25,bordercolor=red,#1]{#2}}
  \newcommandx{\change}[2][1=]{\todo[inline,linecolor=blue,backgroundcolor=blue!25,bordercolor=blue,#1]{#2}}
  \newcommandx{\info}[2][1=]{\todo[linecolor=OliveGreen,backgroundcolor=OliveGreen!25,bordercolor=OliveGreen,#1]{#2}}
  \newcommandx{\improvement}[2][1=]{\todo[linecolor=Plum,backgroundcolor=Plum!25,bordercolor=Plum,#1]{#2}}
\else
  \newcommandx{\unsure}[2][1=]{\todo[disable,linecolor=red,backgroundcolor=red!25,bordercolor=red,#1]{#2}}
  \newcommandx{\change}[2][1=]{\todo[disable,linecolor=blue,backgroundcolor=blue!25,bordercolor=blue,#1]{#2}}
  \newcommandx{\info}[2][1=]{\todo[disable,linecolor=OliveGreen,backgroundcolor=OliveGreen!25,bordercolor=OliveGreen,#1]{#2}}
  \newcommandx{\improvement}[2][1=]{\todo[disable,linecolor=Plum,backgroundcolor=Plum!25,bordercolor=Plum,#1]{#2}}
\fi

%Theorems and definition environment 
\theoremstyle{plain}
\newtheorem{corollary}{Corollary}
\numberwithin{corollary}{section} % important bit

\newtheorem{proposition}{Proposition}
\numberwithin{proposition}{section} % important bit

\newtheorem{theorem}{Theorem}
\numberwithin{theorem}{section} % important bit

\newtheorem{lemma}{Lemma}
\numberwithin{lemma}{section} % important bit

\newtheorem{property}{Property}
\numberwithin{property}{section} % important bit

\theoremstyle{definition}
\newtheorem{definition}{Definition}
\numberwithin{definition}{section} % important bit

\newtheorem{example}{Example}
\numberwithin{example}{section} % important bit

\theoremstyle{remark}
\newtheorem{remark}{Remark}
\numberwithin{remark}{section} % important bit



%TA semantics and predicates
\stackMath
\newcommand{\mf}[1]{\mathbf{#1}}
\newcommand{\mc}[1]{\mathcal{#1}}
\newcommand{\mb}[1]{\mathbb{#1}}
\newcommand{\q}{q} 
\newcommand{\X}{\mc{X}} 
\newcommand{\D}{\mc{D}} 
\newcommand{\E}{\mc{E}} 
\newcommand{\A}{\mc{A}}
\newcommand{\T}{\mc{T}}
\newcommand{\V}{\mc{V}}
\newcommand{\I}{\mc{I}}
\newcommand{\Q}{\mc{Q}} 
\newcommand{\tts}{\texttt{T}}
\newcommand{\TTS}{\tts=(\Q,q_0,\Sigma\cup\mb{K},\to)}
\newcommand{\TTSg}{\tts_g=(\Q_g,q_{0_g},\gamma\cup\realpos,\to_{\gamma})}
\newcommand{\TTSb}[1]{\tts_{#1}=(Q_{#1},q_{0_{#1}},\Sigma\cup\mb{K},\to_{#1})}
\newcommand{\TTSs}{\tts=(\Q,q_0,\A\cup\realpos,\to)}

\newcommand{\TTSbw}[1]{\tts_{#1}=(\Q_{#1},q_{0_{#1}},\Sigma
\cup\{\tau\}\cup\mb{K},\to_{#1})}

\newcommand{\transit}[1]{\xrightarrow{#1}}
\newcommand{\transitb}[2]{\xrightarrow{#1}_{#2}}
\newcommand{\exec}{\varrho}
\newcommand{\texec}{\mf{time(\exec)}}
\newcommand{\integer}{\mb{Z}}
\newcommand{\naturals}{\mb{N}}
\newcommand{\integerpoz}{\mb{Z}_{\ge 0}}
\newcommand{\integerpos}{\mb{Z}_{> 0}}
\newcommand{\realpoz}{\mb{R}_{\ge 0}}
\newcommand{\realpos}{\mb{R}_{> 0}}
\newcommand{\simu}[1]{\sqsubseteq_{#1}}
\newcommand{\simuw}[1]{\dot{\sqsubseteq}_{#1}}
\newcommand{\eqv}[1]{\sim_{#1}}
\newcommand{\eqvw}[1]{\dot{\sim}_{#1}}
\newcommand{\val}{\upsilon}
\newcommand{\Val}{\realpoz^{\X}}
\newcommand{\false}{\textnormal{\textit{false}}}
\newcommand{\true}{\textnormal{\textit{true}}}
\newcommand{\backward}{\raisebox{2pt}{$\swarrow$}}
\newcommand{\backwardp}[2]{\backward^{#2}_{\hspace{-2mm}#1}}
\newcommand{\forward}{\raisebox{2pt}{$\nearrow$}}
\newcommand{\enabledforward}[1]{Enabled\hspace{-0.8pt}\forward\hspace{-1mm}(#1)}
\newcommand{\enabledbackward}[1]{Enabled\hspace{-0.8pt}\backward\hspace{-1mm}(#1)}
\newcommand{\enabledbackwardb}[3]{Enabled\hspace{-0.8pt}\backwardp{#2}{#3}\hspace{-1mm}(#1)}
\newcommand{\Loc}{\mc{L}}
\newcommand{\loc}{\ell}
\newcommand{\locp}{\loc_{\perp}}
\newcommand{\locpb}[2]{\loc_{\perp_{#1}^{#2}}}
\newcommand{\Invb}[2]{\I_{#1}(#2)}
\newcommand{\Inv}[1]{\I(#1)}
\newcommand{\tc}{B=(\Loc,\loc_0,\X,\A,\E,\I)}
\newcommand{\tci}[1]{B_{#1}=(\Loc_{#1},\loc_{0_{#1}},\X_{#1},\A_{#1},\E_{#1},\I_{#1})}
\newcommand{\enabled}[1]{Enabled(#1)}
\newcommand{\p}[1]{part(#1)}
\newcommand{\urgent}{Urgent}
\newcommand{\al}[1]{\textsf{at}(#1)}
\newcommand{\action}{\textsf{action}}
\newcommand{\source}{\textsf{source}}
\newcommand{\target}{\textsf{target}}
\newcommand{\guard}{\textsf{guard}}
\newcommand{\reset}{\textsf{reset}}
%\newcommand{\hmn}{h_{\min}}
\newcommand{\reacha}[1]{\overline{Reach(#1)}}
%\newcommand{\stacktxt}[1]{\mathit{\stackon[0pt]{#1}{\hstretch{7.0}{\sim}}}}
\newcommand{\lpsabrb}{LPS }
\newcommand{\lpsabr}{LPS}
\newcommand{\lps}{local planning semantics }
\newcommand{\lpsb}{local planning semantics}
\NewEnviron{myequation}{%
\begin{displaymath}
\scalebox{1.5}{$\BODY$}
\end{displaymath}
}


%%%%%%%%%%%%%%%%%%PLANNING%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\squig}{{\scriptstyle\sim\mkern-3.9mu}}
\newcommand{\lsquigend}{{\lhd\mkern-3mu}}
\newcommand{\rsquigend}{{\scriptstyle\rule{.1ex}{0ex}>}}
\newcounter{sqindex}
\newcommand\squigs[1]{
    \setcounter{sqindex}{0}
      \whiledo {\value{sqindex}< #1}{\addtocounter{sqindex}{1}\squig}
    }
\newcommand{\tranbp}[2]{
  \mathbin{\stackon[2pt]{\squigs{#2}\rsquigend}{\scriptstyle{#1\,}}}_{\gamma}
}

 
\makeatletter
\def\namedlabel#1#2{\begingroup
  \mbox{\hspace{1cm}}#2%
    \def\@currentlabel{#2}%
    \phantomsection\label{#1}\endgroup
}
\makeatother

\makeatletter
\newcommand{\mytag}[2]{%
 \text{#1}%
  \@bsphack
    \protected@write\@auxout{}%
   {\string\newlabel{#2}{{#1}{\thepage}}}%
  \@esphack
}          
\makeatother


\newcommand{\confl}{\mathit{conf}}
\newcommand{\pmin}{\min(\pi)}
\newcommand{\hmin}{h_{\min}}
\newcommand{\hmax}{h_{\max}}
\newcommand{\hmaxt}{h_{\max}^{\infty}}
\newcommand{\hmaxm}{h_{\max}^{\hmin}}
\newcommand{\hmxb}[1]{h_{\max}(#1)}
\newcommand{\hmx}{h_{\max}(\alpha)}
\newcommand{\plntxt}[1]{\mathit{Plannable(#1)}}
\newcommand{\plntxtb}[1]{\mathit{\stackon[0pt]{Plannable(#1)}{\hstretch{7.0}{\sim}}}}


\newcommand{\tcal}[1]{\mathcal{#1}}
\newcommand{\lto}{\longrightarrow}
\newcommand{\urgb}{\tsf{urg}}
\newcommand{\urg}{\textnormal{\textit{urg}}}
\newcommand{\tpcp}[1]{\textsf{tpc}(#1)}
\newcommand{\tpc}{\textsf{tpc}}

\newcommand{\pln}[1]{\mathit{Plannable(#1)}=\bigvee_{\loc\in\Loc_{#1}}
\al{\loc}\wedge\backhtxt(\bigwedge_{a_i\in#1} \guard{a_i}{\loc_i})}

\newcommand{\plnIntxt}[2]{\mathit{Plannable(#1,#2)}}
\newcommand{\plnIn}[2]{\mathit{Plannable(#1,#2)}=\bigvee_{\loc\in\Loc_{#1}}
\al{\loc}\wedge\bigwedge_{a_i\in#1} \Big(\guard{a_i}{\loc_i}+#2\Big)}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\newcommand{\clock}[1]{\textsf{clock}(#1)}

\newcommand{\valdt}{v^{dt}}                              % valuation of the clocks
\newcommand{\valdtb}{v^{dt'}}                              % valuation of the clocks
\newcommand{\valg}{\bar{v}}                              % valuation of the clocks
\newcommand{\valgp}{\bar{v'}}  
\newcommand{\qdt}{q^{dt}}
\newcommand{\qdtb}{q^{dt'}}
\newcommand{\RS}{R}
\newcommand{\enabledb}{\mathit{Enabled}^{{\scriptscriptstyle
\swarrow^{\epsilon}}}}
\newcommand{\enabledf}{\mathit{Enabled}^{{\scriptscriptstyle
\nearrow^{\epsilon}}}}
\newcommand{\reach}{\textit{Reach}}
\newcommand{\simdt}{\sqsubseteq^{\epsilon*}_{\RS}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%DRIFT%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeatletter
\pgfdeclareshape{document}{
\inheritsavedanchors[from=rectangle] % this is nearly a rectangle
\inheritanchorborder[from=rectangle]
\inheritanchor[from=rectangle]{center}
\inheritanchor[from=rectangle]{north}
\inheritanchor[from=rectangle]{south}
\inheritanchor[from=rectangle]{west}
\inheritanchor[from=rectangle]{east}
\inheritanchor[from=rectangle]{north east}
\inheritanchor[from=rectangle]{north west}
\inheritanchor[from=rectangle]{south east}
\inheritanchor[from=rectangle]{south west}
% ... and possibly more
\backgroundpath{% this is new
% store lower right in xa/ya and upper right in xb/yb
\southwest \pgf@xa=\pgf@x \pgf@ya=\pgf@y
\northeast \pgf@xb=\pgf@x \pgf@yb=\pgf@y
% compute corner of ‘‘flipped page’’
\pgf@xc=\pgf@xb \advance\pgf@xc by-7pt % this should be a parameter
\pgf@yc=\pgf@yb \advance\pgf@yc by-7pt
% construct main path
\pgfpathmoveto{\pgfpoint{\pgf@xa}{\pgf@ya}}
\pgfpathlineto{\pgfpoint{\pgf@xa}{\pgf@yb}}
\pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yb}}
\pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yc}}
\pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@ya}}
\pgfpathclose
% add little corner
\pgfpathmoveto{\pgfpoint{\pgf@xc}{\pgf@yb}}
\pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
\pgfpathlineto{\pgfpoint{\pgf@xb}{\pgf@yc}}
\pgfpathlineto{\pgfpoint{\pgf@xc}{\pgf@yc}}
}
}
\makeatother


\tikzstyle{doc}=[%
  draw,
  thick,
  align=center,
  color=black,
  shape=document,
  minimum width=11mm,
  minimum height=6mm,
  shape=document,
  inner sep=1ex,
]


\tikzset{                                 
  connect/.style args={(#1) to (#2) over (#3) by #4}{
    insert path={                         
    let                             
    \p1=($(#1)-(#3)$),            
    \n1={veclen(\x1,\y1)},        
    \n2={atan2(\y1,\x1)},         
    \n3={abs(#4)},                
    \n4={#4>0 ?180:-180}          
      in                            
      (#1) -- ($(#1)!\n1-\n3!(#3)$) 
      arc (\n2:\n2+\n4:\n3) -- (#2) 
    }                                     
  },                                       
  rc/.style={rounded corners=2mm,line width=1pt},
  ->,
  node distance=1.3cm,
  >=stealth',
  bend angle=20,
  auto,
  place/.style={text width=6mm,align=center,circle,thick,draw=blue!75,fill=blue!20,minimum size=8mm},
  redplace/.style={place,draw=red!75,fill=red!20},
  markplace/.style={place,draw=black!75,fill=black!20},
  dots/.style={fill=black,circle,inner sep=2pt},
  initial text={},
  sh2w/.style={shift={(-0.7,0)}},
  sh2w2/.style={shift={(-1.5,0)}},
  sh2nw/.style={shift={(-0.7,0.5)}},
  sh2ne/.style={shift={(0.7,0.5)}},
  sh2sw/.style={shift={(-0.7,-0.5)}},
  sh2sw2/.style={shift={(-1.5,-0.5)}},
  sh2se/.style={shift={(0.7,-0.5)}},
  h2n/.style={shift={(0,.5)}},
  h2s/.style={shift={(0,-.5)}},
  h2se/.style={shift={(0.5,-1.1)}},
  h2e/.style={shift={(0.5,0)}},
  rc/.style={rounded corners=2mm},
  triangle/.style={fill=black,regular polygon,regular polygon sides=3,
   minimum size=10pt,inner sep=0pt},
  transition/.style={
    rectangle,
    thick,
    fill=black,
    minimum width=7mm,
    inner ysep=0.5mm
  },
  rectnodes/.style args={#1,#2}{
  draw=black,        
  rounded corners,
  thick,             
  minimum width=#1 cm,
  minimum height=#2 cm,
  },                   
  rectnode/.style args={#1,#2}{
  rounded corners,
  draw=red!50,       
  fill=yellow!30,    
  thick,             
  minimum width=#1 cm,
  minimum height=#2 cm,
  }        
}       

\definecolor{mymagenta}{RGB}{226,0,116}
\definecolor{mygray}{RGB}{208,208,208}
\newcommand*{\mytextstyle}{\color{black}}
\newcommand{\arcarrow}[4]{%
   % inner radius, middle radius, outer radius, start angle,
   % end angle, tip protusion angle, options, text
   \pgfmathsetmacro{\rin}{3}
   \pgfmathsetmacro{\rmid}{3.5}
   \pgfmathsetmacro{\rout}{4}
   \pgfmathsetmacro{\astart}{#1}
   \pgfmathsetmacro{\aend}{#2}
   \pgfmathsetmacro{\atip}{1}
   \fill[#4, very thick] (\astart+\atip:\rin)
                         arc (\astart+\atip:\aend:\rin)
      -- (\aend-\atip:\rmid)
      -- (\aend:\rout)   arc (\aend:\astart+\atip:\rout)
      -- (\astart:\rmid) -- cycle;
   \path[
      decoration = {
         text along path,
         text = {|\mytextstyle|#3},
         text align = {align = center},
         raise = -1.0ex
      },
      decorate
   ](\astart+\atip:\rmid) arc (\astart+\atip:\aend+\atip:\rmid);
}

\tcbset{
frame code={}
center title,
left=0pt,
right=0pt,
top=0pt,
bottom=0pt,
colback=gray!10,
colframe=white,
width=\dimexpr\textwidth\relax,
enlarge left by=0mm,
boxsep=5pt,
arc=0pt,outer arc=0pt,
}



\newcommand{\nt}[1]{|\textbf{#1}|}
